---
title: "Ethnicity and Self-Identity"
subtitle: "Exploration of 2020 Pew Research Center Survey"
author: "Michael Foley"
date: "`r Sys.Date()`"
output: 
  html_document:
    css: "style.css"
    theme: flatly
    toc: true
    toc_float: true
    highlight: haddock
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE
)

library(tidyverse)
library(janitor)
library(sf)
library(survey)
```

Ipsos Public Affairs (Ipsos) conducted a survey on behalf of Pew Research from Jan 3-13, 2020 related to knowledge and attitudes about the 2020 census. The target population was non-institutionalized adults age 18 and older residing in the United States. The survey was conducted in part to explore the impact of a change in questions related to race and ethnicity. This project further explores racial/ethnic identity, estimating its relationship with other social and demographic factors: age, gender, education, and state of residence.

# Load Data Set

The [2020 Census survey #1](https://www.pewresearch.org/social-trends/dataset/2020-census-survey-1/) data set is available for download at the PEW Research web site.^[Navigate to this survey from the [Pew Research Center home page](https://www.pewresearch.org/) by clicking TOOLS & RESOURCES > Dataset Downloads > Social & Demographic Trends > 2020 Census survey #1. You may have to register for a free account.]

```{r warning=FALSE, message=FALSE, class.source = 'fold-show'}
pew_dat_0 <- foreign::read.spss(
  "./census_dat/Jan20 Census_cleaned dataset.sav", 
  to.data.frame = TRUE
)

dim(pew_dat_0)
```

The data set consists of 156 variables collected from 3,535 participants. Only a fraction of the columns are of interest for this analysis.

```{r}
pew_dat_1 <- pew_dat_0 %>%
  mutate(
    CENRACE2020 = case_when(
      CENRACE2020_1  == "Yes" ~ "White",
      CENRACE2020_2  == "Yes" ~ "Black", # Black or African American
      CENRACE2020_3  == "Yes" ~ "Other", # American Indian or Alaska Native
      CENRACE2020_4  == "Yes" ~ "Asian", # Chinese
      CENRACE2020_5  == "Yes" ~ "Asian", # Filipino
      CENRACE2020_6  == "Yes" ~ "Asian", # Asian Indian
      CENRACE2020_7  == "Yes" ~ "Asian", # Vietnamese
      CENRACE2020_8  == "Yes" ~ "Asian", # Korean
      CENRACE2020_9  == "Yes" ~ "Asian", # Japanese
      CENRACE2020_10 == "Yes" ~ "Asian", # Other Asian
      CENRACE2020_11 == "Yes" ~ "Pacific Islander", # Native Hawaiian
      CENRACE2020_12 == "Yes" ~ "Pacific Islander", # Samoan
      CENRACE2020_13 == "Yes" ~ "Pacific Islander", # Chamorro
      CENRACE2020_14 == "Yes" ~ "Pacific Islander", # Other Pacific Islander
      CENRACE2020_15 == "Yes" ~ "Other", # Some other race
      TRUE ~ "Other"
    ),
    simple_eth = factor(
      case_when(
        racnum == 1 & CENHISPAN2020_1 == "Yes" & CENRACE2020 == "White" ~ "White",
        racnum == 1 & CENHISPAN2020_1 == "Yes" & CENRACE2020 == "Black" ~ "Black",
        racnum == 1 & CENHISPAN2020_1 == "No" ~ "Hispanic",
        TRUE ~ "Other"
      ),
      levels = c("White", "Black", "Hispanic", "Other")
    ),
    CENIDENTITYa = factor(
      CENIDENTITYa, 
      levels = c("My origin is not central to my identity", 
                 "My origin is central to my identity", 
                 "Refused"),
      labels = c("Not central", "Central", "Refused")
    ),
    CENIDENTITYb = factor(
      CENIDENTITYb, 
      levels = c("I am not too familiar with my origins", 
                 "I am very familiar with my origins", 
                 "Refused"),
      labels = c("Not too familiar", "Very familiar", "Refused")
    ),
    CENIDENTITYc = factor(
      CENIDENTITYc, 
      levels = c("I do not feel a strong connection with the cultural origin of my family", 
                 "I feel a strong connection with the cultural origin of my family", 
                 "Refused"),
      labels = c("Not a strong connection", "Strong connection", "Refused")
    ),
    IDEO = factor(
      IDEO, 
      levels = c("Very conservative", "Conservative", "Moderate", "Liberal", "Very liberal", "Refused"),
      ordered = TRUE
    ),
    ppagecat = factor(ppagecat, ordered = TRUE),
    ppagecat = fct_drop(ppagecat),
    ppagect4 = factor(ppagect4, ordered = TRUE),
    ppagect4 = fct_drop(ppagect4),
    ppeducat = factor(ppeducat, ordered = TRUE),
    CASEID = as.character(CASEID),
    RACEOE_1 = factor(if_else(!str_detect(RACEOE_1, "^Protest"), "Other", "Protest"))
  ) %>%
  select(
    CASEID, weight, simple_eth, CENIDENTITYa, CENIDENTITYb, CENIDENTITYc, IDEO,
    RACEOE_1,
    ppage, ppagecat, ppagect4, ppeducat, ppgender, ppreg4, 
    ppreg9, ppstaten
  )

pew_dat_1 %>% skimr::skim()
```

# Data Exploration 

```{r echo=FALSE}
plot_summary_by_var <- function(dat) {
  metric_levels <- dat %>% pull(metric_var) %>% levels()
  metric_fill <- c("#ddbea9", "#b7b7a4", "#FFFFFF")
  names(metric_fill) <- metric_levels
  dat %>%
    filter(metric_var != "Refused" & simple_eth != "Other") %>%
    # mutate(metric_var = fct_drop(metric_var)) %>%
    ggplot(aes(x = fct_rev(factor_var), fill = metric_var)) +
    geom_col(aes(y = pct_val), width = 0.75) +
    geom_text(aes(y = pct_val / 2, 
                  label = scales::percent(pct, accuracy = 1)), 
              size = 3.25, hjust = +0.5, vjust = 0.30) +
    coord_flip() +
    scale_y_continuous(limits = c(-.91, .91), labels = NULL) +
    geom_hline(yintercept = 0, color = "gray60") +
    geom_vline(xintercept = " ", linetype = 2, color = "gray60") +
    labs(
      x = NULL, y = NULL,
      title = stringr::str_wrap("Black and Hispanic adults feel more connected to roots than White Adults", 40),
      caption = stringr::str_wrap(paste0(
        "Note: White and Black adults include those who report being only one race ",
        "and are not Hispanic. Hispanics are of any race. Share of respondents ",
        "who didn't offer an answer not shown. <br>",
        "Source: Survey of U.S. adults conducted Jan. 3-13, 2020.",
        "`Black and Hispanic Americans See Their Origins as Central to Who They Area, ",
        "Less So for White Adults'."),
        width = 55),
      subtitle = "% saying they are..."
    ) +
    annotate("text", x = "", y = -.5, label = stringr::str_wrap(metric_levels[1], 12), 
             size = 2.5, color = "#cb997e", fontface = "bold", hjust = .5) +
    annotate("text", x = "", y = +.5, label = stringr::str_wrap(metric_levels[2], 12), 
             size = 2.5, color = "#6b705c", fontface = "bold", hjust = .5) +
    scale_fill_manual(values = metric_fill) +
    theme_light() +
    theme(
      panel.grid = element_blank(),
      legend.position = "none",
      axis.ticks = element_blank(),
      plot.caption = element_text(color = "gray60", size = 8.5, hjust = 0),
      plot.title = element_text(color = "gray20", size = 11.5, face = "bold"),
      plot.subtitle = element_text(color = "gray40", size = 9.5, face = "italic")
    )
}

summarize_metric <- function(dat, metric_var) {
  metric_levels <- dat %>% pull(!!ensym(metric_var)) %>% levels()
  detail <- dat %>%
    group_by(simple_eth, metric_var = !!ensym(metric_var)) %>%
    summarize(.groups = "drop", n = sum(weight)) %>%
    group_by(simple_eth) %>%
    mutate(pct = n / sum(n))
  overall <- dat %>%
    group_by(simple_eth = "All", metric_var = !!ensym(metric_var)) %>%
    summarize(.groups = "drop", n = sum(weight)) %>%
    group_by(simple_eth) %>%
    mutate(pct = n / sum(n))
  blanks_1 <- dat %>%
    count(simple_eth = "", metric_var = !!ensym(metric_var)) %>%
    mutate(pct = NA_real_)
  blanks_2 <- dat %>%
    count(simple_eth = " ", metric_var = !!ensym(metric_var)) %>%
    mutate(pct = NA_real_)
  bind_rows(detail, overall, blanks_1, blanks_2) %>%
    mutate(
      simple_eth = factor(simple_eth),
      simple_eth = fct_relevel(simple_eth, "", "All", " "),
      pct_val = pct * if_else(metric_var == metric_levels[2], +1, -1)
    )  %>%
    ungroup()
}
```

## Importance of Cultural Origins {.tabset}

The following figures loosely follow Pew's 5/14/2021 report, [Black and Hispanic Americans See Their Origins as Central to Who They Are, Less So for White Adults](https://www.pewresearch.org/social-trends/2021/05/14/black-and-hispanic-americans-see-their-origins-as-central-to-who-they-are-less-so-for-white-adults/).

The main conclusion from Pew's report is that the importance of ancestral roots varies by race and ethnicity. The first, second, and fourth figures in the report are based on three questions about the respondent's relationship to their cultural origin of their family. Question `CENIDENTITYa` asks how *central* their origins are to their identity; Question `CENIDENTITYb` asks how *familiar* they are with their origins; and `CENIDENTITYc` asks how *connected* the respondent is with their origins.

### CENIDENTITYa

:::: {style="display: grid; grid-template-columns: 1fr 1fr; grid-column-gap: 10px;"}

::: {}
>Here is a pair of statements about how you think about your origin (for example, German, Mexican, Jamaican, Chinese, etc.) Which statement comes closer to your view – even if neither is exactly right? 
>
>1 My origin is central to my identity
>
>2 My origin is not central to my identity
:::

::: {}
```{r fig.height=3.5, fig.width=3.5, warning=FALSE, echo=FALSE}
pew_dat_1 %>% 
  summarize_metric("CENIDENTITYa") %>%
  mutate(factor_var = fct_relevel(simple_eth, levels(pew_dat_1$simple_eth), after = 3)) %>%
  plot_summary_by_var() +
  ggtitle(stringr::str_wrap("Origins more central to identity for Black and Hispanic adults than for White", 40))
```
:::

::::

### CENIDENTITYb

:::: {style="display: grid; grid-template-columns: 1fr 1fr; grid-column-gap: 10px;"}

::: {}
>Here is a pair of statements about how you think about your origin (for example, German, Mexican, Jamaican, Chinese, etc.) Which statement comes closer to your view – even if neither is exactly right? 
>
>1 I am very familiar with my origins
>
>2 I am not too familiar with my origins
:::

::: {}
```{r fig.height=3.5, fig.width=3.5, warning=FALSE, echo=FALSE}
pew_dat_1 %>% 
  summarize_metric("CENIDENTITYb") %>%
  mutate(factor_var = fct_relevel(simple_eth, levels(pew_dat_1$simple_eth), after = 3)) %>%
  plot_summary_by_var() +
  ggtitle(stringr::str_wrap("Six-in-ten Americans say they are very familiar with their origins", 40))
```
:::

::::

### CENIDENTITYc

:::: {style="display: grid; grid-template-columns: 1fr 1fr; grid-column-gap: 10px;"}

::: {}
>Here is a pair of statements about how you think about your origin (for example, German, Mexican, Jamaican, Chinese, etc.) Which statement comes closer to your view – even if neither is exactly right?
>
>1 I feel a strong connection with the cultural origin of my family
>
>2 I do not feel a strong connection with the cultural origin of my family
:::

::: {}
```{r fig.height=3.5, fig.width=3.5, warning=FALSE, echo=FALSE}
pew_dat_1 %>% 
  summarize_metric("CENIDENTITYc") %>%
  mutate(factor_var = fct_relevel(simple_eth, levels(pew_dat_1$simple_eth), after = 3)) %>%
  plot_summary_by_var() +
  ggtitle(stringr::str_wrap("Black and Hispanic adults feel more connected to roots than White Adults", 40))
```
:::

::::

## Relationship with Social and Demographic Factors

The Ipsos survey includes three social and demographic variables that can further segment the race/ethnicity differences.

```{r}
summarize_by_var <- function(dat, metric_var, factor_var) {
  metric_levels <- dat %>% pull(!!ensym(metric_var)) %>% levels()
  detail <- dat %>%
    group_by(simple_eth, factor_var = !!ensym(factor_var), metric_var = !!ensym(metric_var)) %>%
    summarize(.groups = "drop", n = sum(weight)) %>%
    group_by(simple_eth, factor_var) %>%
    mutate(pct = n / sum(n))
  overall <- dat %>%
    group_by(simple_eth, factor_var = "All", metric_var = !!ensym(metric_var)) %>%
    summarize(.groups = "drop", n = sum(weight)) %>%
    group_by(simple_eth, factor_var) %>%
    mutate(pct = n / sum(n))
  blanks_1 <- dat %>%
    count(simple_eth, factor_var = "", metric_var = !!ensym(metric_var)) %>%
    mutate(pct = NA_real_)
  blanks_2 <- dat %>%
    count(simple_eth, factor_var = " ", metric_var = !!ensym(metric_var)) %>%
    mutate(pct = NA_real_)
  bind_rows(detail, overall, blanks_1, blanks_2) %>%
    mutate(
      factor_var = factor(factor_var),
      factor_var = fct_relevel(factor_var, "", "All", " "),
      metric_var = factor(metric_var),
      metric_var = fct_relevel(metric_var, "Refused", after = Inf),
      pct_val = pct * if_else(metric_var == metric_levels[2], +1, -1)
    )  %>%
    ungroup()
}
```

### Education {.tabset}

Variable `ppeducat` is defined as the highest level of education received. The results below are likely influenced by age since younger respondents are unlikely to have a Bachelor's degree or higher.

#### CENIDENTITYa

:::: {style="display: grid; grid-template-columns: 1fr 3fr; grid-column-gap: 10px;"}

::: {}
Their is an inverse relationship between level of education received and the importance of family origins for all three race/ethnicity groups. Black Americans with less than a high school degree are a possible exception.
:::

::: {}
```{r fig.height=3.5, warning=FALSE, echo=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYa", "ppeducat") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppeducat), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYa), after = 0)
  ) %>% 
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Centrality of Origins Diminishes with Education")
```
:::

::::

#### CENIDENTITYb

:::: {style="display: grid; grid-template-columns: 1fr 3fr; grid-column-gap: 10px;"}

::: {}
Familiarity with family origins increases with education level for all three race/ethnicity groups. Black Americans with less than a high school degree are a possible exception.
:::

::: {}
```{r fig.height=3.5, warning=FALSE, echo=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYb", "ppeducat") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppeducat), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYb), after = 0)
  ) %>%
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Familiarity with Origins Increases with Education")
```
:::

::::

#### CENIDENTITYc

:::: {style="display: grid; grid-template-columns: 1fr 3fr; grid-column-gap: 10px;"}

::: {}
A third of white Americans report a strong connection to family origins, a proportion that is not moderated by level of education. There is a mild positive association in connectedness for Black Americans, and a mild negative association with Hispanic Americans.
:::

::: {}
```{r fig.height=3.5, warning=FALSE, echo=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYc", "ppeducat") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppeducat), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYc), after = 0)
  ) %>%
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Connection with Origins Unrelated to Education")
```
:::

::::

### Age {.tabset}

Variables `ppage`, `ppagecat` (7 levels), `ppagect4` (4 levels) are the respondent's age.

#### CENIDENTITYa

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYa", "ppagecat") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppagecat), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYa), after = 0)
  ) %>% 
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Centrality of Origins Unrelated to Age")
```

</div>

Cultural origins are not central to the identity of White Americans regardless of age (perhaps a mild positive relationship?). For Black Americans there is a bell shaped distribution. For Hispanic Americans, cultural origins are central to identity regardless of age (perhaps a mild negative relationship?).

#### CENIDENTITYb

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYb", "ppagecat") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppagecat), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYb), after = 0)
  ) %>%
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Familiarity with Origins Increases with Age")
```

</div>

Familiarity with family origins increases with age level for all three race/ethnicity groups. Black Americans over 75 years of age are a possible exception.

#### CENIDENTITYc

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYc", "ppagecat") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppagecat), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYc), after = 0)
  ) %>%
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Connection with Origins Unrelated to Age")
```

</div>

Connection to family origins does not appear to be related to age for any race/ethnicity.

### Gender {.tabset}

Variable `ppeducat` is defined as the highest level of education received. The results below are likely influenced by age since younger respondents are unlikely to have a Bachelor's degree or higher.

#### CENIDENTITYa

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYa", "ppgender") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppgender), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYa), after = 0)
  ) %>% 
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Centrality of Origins Varies Little with Gender")
```

</div>

White women were slightly more likely than White men to report family cultural origins were central to their identity. For Black Americans the relationship is reversed. Hispanic Women were more much more likely to report a central role for cultural origins than men.

#### CENIDENTITYb

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYb", "ppgender") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppgender), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYb), after = 0)
  ) %>%
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Familiarity with Origins Unrelated with Gender")
```

</div>

Familiarity with family origins is about equal between genders of all three groups.

#### CENIDENTITYc

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_1 %>% 
  summarize_by_var("CENIDENTITYc", "ppgender") %>%
  mutate(
    factor_var = fct_relevel(factor_var, levels(pew_dat_1$ppgender), after = Inf),
    metric_var = fct_relevel(metric_var, levels(pew_dat_1$CENIDENTITYc), after = 0)
  ) %>%
  plot_summary_by_var() +
  facet_wrap(~simple_eth, nrow = 1) +
  ggtitle("Connection with Origins Varies Little with Gender")
```

</div>

Connection to family origins does not appear to be related to gender for any race/ethnicity.

### Geography {.tabset}

Variable `ppeducat` is defined as the highest level of education received. The results below are likely influenced by age since younger respondents are unlikely to have a Bachelor's degree or higher.

#### CENIDENTITYa

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
us_states <- map_data("state")

lu_state <- tibble(st = state.abb, region = str_to_lower(state.name))

pew_dat_reg9 <- pew_dat_1 %>% 
  # one row per state
  count(ppstaten, ppreg9, ppreg4) %>% select(-n) %>% 
  # one row per state per ethnicity
  full_join(
    tibble(simple_eth = levels(pew_dat_1$simple_eth)), 
    by = character()
  ) %>% 
  # now left join the actual data
  left_join(pew_dat_1, by = c("ppstaten", "ppreg9", "ppreg4", "simple_eth")) %>% 
  replace_na(replace = list(weight = 0, 
                            CENIDENTITYa = "Central",
                            CENIDENTITYb = "Very familiar",
                            CENIDENTITYc = "Strong connection")) %>%
  group_by(ppstaten, ppreg9, simple_eth) %>%
  summarize(
    .groups = "drop", 
    ppstaten_CENIDENTITYa_Central = sum(if_else(CENIDENTITYa == "Central", weight, 0)),
    ppstaten_CENIDENTITYb_Familiar = sum(if_else(CENIDENTITYb == "Very familiar", weight, 0)),
    ppstaten_CENIDENTITYc_Connected = sum(if_else(CENIDENTITYc == "Strong connection", weight, 0)),
    ppstaten_wt = sum(weight)
  ) %>%
  ungroup() %>%
  group_by(ppreg9, simple_eth) %>%
  mutate(
    ppreg9_CENIDENTITYa_Central = sum(ppstaten_CENIDENTITYa_Central),
    ppreg9_CENIDENTITYb_Familiar = sum(ppstaten_CENIDENTITYb_Familiar),
    ppreg9_CENIDENTITYc_Connected = sum(ppstaten_CENIDENTITYc_Connected),
    ppreg9_wt = sum(ppstaten_wt)
  ) %>%
  ungroup() %>%
  mutate(
    ppstaten_CENIDENTITYa_Central_pct = ppstaten_CENIDENTITYa_Central / ppstaten_wt,
    ppstaten_CENIDENTITYb_Familiar_pct = ppstaten_CENIDENTITYb_Familiar / ppstaten_wt,
    ppstaten_CENIDENTITYc_Connected_pct = ppstaten_CENIDENTITYc_Connected / ppstaten_wt,
    ppreg9_CENIDENTITYa_Central_pct = ppreg9_CENIDENTITYa_Central / ppreg9_wt,
    ppreg9_CENIDENTITYb_Familiar_pct = ppreg9_CENIDENTITYb_Familiar / ppreg9_wt,
    ppreg9_CENIDENTITYc_Connected_pct = ppreg9_CENIDENTITYc_Connected / ppreg9_wt
  )

plot_geo <- function(dat, metric) {
  dat %>%
    inner_join(lu_state, by = c("ppstaten" = "st")) %>%
    inner_join(us_states, by = "region") %>%
    filter(simple_eth != "Other") %>%
    ggplot(aes(x = long, y = lat, group = group, fill = !!ensym(metric))) +
    geom_polygon() +
    coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
    scale_fill_continuous(labels = scales::percent_format(accuracy = 1)) +
    facet_wrap(facets = vars(simple_eth), nrow = 1) +
    labs(
      fill = NULL,
      caption = stringr::str_wrap(paste0(
        "Note: White and Black adults include those who report being only one race ",
        "and are not Hispanic. Hispanics are of any race. Share of respondents ",
        "who didn't offer an answer not shown. ",
        "Source: Survey of U.S. adults conducted Jan. 3-13, 2020.",
        "`Black and Hispanic Americans See Their Origins as Central to Who They Area, ",
        "Less So for White Adults'."),
        width = 100)
    ) +
    theme(
      axis.line = element_blank(),
      axis.text = element_blank(),
      axis.ticks = element_blank(),
      axis.title = element_blank(),
      panel.background = element_blank(),
      panel.border = element_blank(),
      panel.grid = element_blank(),
      legend.position = "right",
      plot.caption = element_text(hjust = 0)
    )
}

pew_dat_reg9 %>% 
  plot_geo(ppreg9_CENIDENTITYa_Central_pct) +
  labs(title = "% Saying Origin is Central to Their Identity")
```

</div>

Americans on the coasts were more likely to report family cultural origins were central to their identity.

#### CENIDENTITYb

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_reg9 %>% 
  plot_geo(ppreg9_CENIDENTITYb_Familiar_pct) +
  labs(title = "% Saying They are Familiar with their Origins")
```

</div>

Familiarity with family origins is more common in the interior rather than the coasts.

#### CENIDENTITYc

<div style= "float:right;position: relative; top: -80px;">

```{r warning=FALSE}
pew_dat_reg9 %>% 
  plot_geo(ppreg9_CENIDENTITYc_Connected_pct) +
  labs(title = "% Saying They Feel a Strong Connection with the Cultural Origin of Their Family")
```

</div>

Connection to family origins is highest in the Mountain states for Black Americans, and the Atlantic states for Hispanic Americans.

# Survey Object

Set up a survey object using the **survey** package.

```{r fig.height=3.0, fig.width=3.5, warning=FALSE}
pew_survey <- svydesign(
  ids = ~1,
  weights = ~ weight,
  data = pew_dat_1
)

svytable(~simple_eth + CENIDENTITYb, pew_survey) %>%
  as_tibble() %>% 
  pivot_wider(names_from = CENIDENTITYb, values_from = n) %>%
  adorn_percentages()
```

```{r}
# x <- svyglm(CENIDENTITYb~simple_eth, family=quasibinomial, design = pew_survey, na.action = na.omit) 
# x %>% broom::tidy(exponentiate = TRUE)
# 
# x <- svyby(~CENIDENTITYb, ~simple_eth, pew_survey, svymean, covmat = TRUE)
# vcov(x)
# svycontrast(x, c(-1, 1))
```
